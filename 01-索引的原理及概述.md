- 索引的定义
- 索引的数据结构(原理)
- 索引的适用场景(什么情况下使用能提高效率)
- 索引的种类

# 索引的定义
- 索引是帮助数据库管理系统⾼效获取数据的数据结构
- 数据库中的索引，就好⽐⼀本书的⽬录，它可以帮我们快速进⾏特定 值的定位与查找，从⽽加快数据查询的效率。
- 索引的价值是帮我们从海量数据中找到想要的数据，如果数据量少，那么是否使⽤索引对结果的影响并不⼤。 
>   UNIQUE INDEX `name`(`name`) USING BTREE

# 索引的数据结构(原理)
## 数据库服务器有两种存储介质，分别为硬盘和内存。
-  内存:临时存储,容量有限;当发⽣意外时（⽐如断电或者发⽣故障重启）会造成数据丢失
-  硬盘:相当于永久存储介质.在硬盘上进⾏查询时，就产⽣了硬盘的 I/O 操作。
-  我们通过索引来查找某⾏数据的时候，需要计算产⽣的磁盘 I/O 次数,当磁盘 I/O 次数越多，所消耗的时间也就越⼤ 
## ⼆叉树,B树,B+树
-  ⼆分查找法:⼀种⾼效的数据检索方式,时间复杂度为 O(log2n),当二叉树深度不深时,磁盘 I/O次数不多,但在某些特定顺序下,eg:(5, 22, 23, 34, 77, 89, 91),
此时的二叉树相当于一个链表,每访问一次节点就要进行一次I/O操作,磁盘I/O次数较多. 在此基础上改进为平衡二叉树(AVL树,包括平衡⼆叉搜索树、红⿊树、数堆、伸展树):每个节点的左⼦树和右⼦树的⾼度差不能超过1.虽然平衡⼆叉树效率⾼，但是数据量大时,树的深度也同样⾼，这就意味着磁盘 I/O 操作次数多会影响整体数据查询的效率。 
当把二叉树改进为M叉树时,深度会继续变浅,磁盘I/O次数减少,所以引进*B树和B+树*
##  B树:
-  每⼀个节点最多可以包括 M 个⼦节点，M 称为 B 树的阶。每个磁盘块中包括了关键字和⼦节点的指针。如果⼀个磁盘块中包括了 x 个关键字，那么指针数就是 x+1。B 树相⽐于平衡⼆叉树来说磁盘 I/O 操作要少，在数据查询中⽐平衡⼆叉树效率要⾼。
-  *⼀个M阶的B树(M>2)的特征*                   
>  1.根节点的⼉⼦数的范围是 [2,M]                                                                                                                                                   
>  2.每个中间节点包含k-1个关键字和k个孩⼦，孩⼦的数量=关键字的数量+1,k的取值范围为 [ceil(M/2),M]                                                                                           
>  3.叶⼦节点包括 k-1 个关键字（叶⼦节点没有孩⼦），k 的取值范围为 [ceil(M/2), M]                                                                                       
>  4.假设中间节点节点的关键字为：Key[1], Key[2], …, Key[k-1]，且关键字按照升序 排序，即Key[i]<Key[i+1]。此时 k-1 个关键字相当于划分了 k 个范围，也就是对应着 k个指针,即为：P[1], P[2], …, P[k],其中P[1]指向关键字⼩于Key[1]的⼦树,P[i]指向关键字属于(Key[i-1],Key[i])的⼦树,P[k]指向关键字⼤于Key[k-1]的⼦树。    
>  5.所有叶⼦节点位于同⼀层    
##  B+树:
-  B+树基于 B 树做出了改进,主流的 DBMS 都⽀持 B+ 树的索引⽅式，⽐如 MySQL。
-  B+树的特点是能够保持数据稳定有序，其插入与修改拥有较稳定的对数时间复杂度。B+树元素自底向上插入，这与二叉树恰好相反。
###  B树和B+树的差异:                                                                                                                                                                                                                    
>   1.有 k 个孩⼦的节点就有 k 个关键字。也就是孩⼦数量 = 关键字数，⽽ B 树中， 孩⼦数量 = 关键字数+1。                                                       
>   2.⾮叶⼦节点的关键字也会同时存在在⼦节点中，并且是在⼦节点中所有关键字的 最⼤（或最⼩）。                                                                    
>   3.⾮叶⼦节点仅⽤于索引，不保存数据记录，跟记录有关的信息都放在叶⼦节点 中。⽽ B 树中，⾮叶⼦节点既保存索引，也保存数据记录。                                             
>   4.所有关键字都在叶⼦节点出现，叶⼦节点构成⼀个有序链表，⽽且叶⼦节点本⾝ 按照关键字的⼤⼩从⼩到⼤顺序链接。       
-   B+树和B树有个根本的差异在于，*B+树的中间节点并不直接存储数据*
-   B+树的查询效率更高,因为通常 B+树⽐ B 树更矮胖（阶数更⼤，深度 更低）,查询所需要的磁盘 I/O 也会更少。同样的磁盘⻚⼤⼩，B+树可以存储更多的节点关键字。
-   在查询范围上，B+树的效率也⽐ B树⾼。这是因为所有关键字都出现在B+树的叶⼦节点中，并通过有序链表进⾏了链接。⽽在B树中则需要通过中序遍历才能完成查询范围的查找,效率要低很多。
#### 总结:
    磁盘的 I/O 操作次数对索引的使⽤效率⾄关重要。虽然传统的⼆叉树数据结构查找数据的效率⾼，但很容易增加磁盘I/O操作的次数，影响索引使⽤的效率。
    因此在构造索引的时候，我们更倾向于采⽤“矮胖”的数据结构.B树和B+树都可以作为索引的数据结构，在MySQL中采⽤的是 B+树，B+树在查询性能上更稳定，
    在磁盘⻚⼤⼩相同的情况下，树的构造更加矮胖，所需要进⾏的磁盘 I/O次数更少，更适合进⾏关键字的范围查询。 

# 索引的适用场景(什么情况下使用能提高效率)
- 索引是用于数据量大时,当数据量不大时,索引的作用会变小.
- 索引适用于定位的数据不需要很多时,如果想要定位的数据很多(eg:性别(男生人数和女生人数相差不大时,需要定位一半数据)),那么索引就失去了其价值.
但当男生人数和女生人数相差很大时,eg:男生人数很少10,女生人数很多10万,这时找男生的数据就可以用索引.所以还要考虑这个字段中的数值分布情况.

# 索引的种类
## 功能逻辑分类:
### 普通索引
- 基础的索引，没有任何约束，主要⽤于提⾼查询效率。
### 唯一索引
- 在普通索引的基础上增加了数据 唯⼀性的约束，在⼀张数据表⾥可以有多个唯⼀索引。
### 主键索引
- 主键索引在唯⼀索引的基础上增加了不为空的约束，也就是NOT NULL+UNIQUE，⼀张表⾥最多只有⼀个主键索引。
### 全文索引
- MySQL ⾃带的全⽂索引只支持英⽂。我们通常可以采⽤专⻔的全⽂搜索引擎，⽐如 ES(ElasticSearch)和Solr。
### 四种索引的联系
- 普通索引,唯一索引,主键索引是一类索引,但是对数据的约束性逐渐提升.在⼀张数 据表中只能有⼀个主键索引，这是由主键索引的物理实现⽅式决定的，因为数据存储在⽂件中只能按照⼀种顺序进⾏存储。但可以有多个普通索引或者多个唯⼀索引。 
## 物理实现分类:
### 聚集索引
- 按照主键来排序存储数据,eg:⼀本汉语字典，我们 想要查找“数”这个字，直接在书中找汉语拼⾳的位置即可，也就是拼⾳“shu”。这样找到了索引的位置，在它后⾯就是我们想要找的数据⾏。
### 非聚集索引(二级索引/辅助索引)
- 数据库系统会有单独的存储空间存放⾮聚集索引，这些索引项是按照顺序存储的，但索引项指向的内容是随机 存储的。也就是说系统会进⾏两次查找，第⼀次先找到索引，第⼆次找到索引对应的位置取出数据⾏。
- 非聚集索引是维护单独的索引表（只维护索引，不维护索 引指向的数据），为数据检索提供⽅便.
- eg:以汉语字典为例，如果想要查找“数”字，那么按照部⾸查找的⽅ 式，先找到“数”字的偏旁部⾸，然后这个⽬录会告诉我们“数”字存放到第多少⻚，我们再去指定的⻚码找这个 字。
#### 聚集索引与⾮聚集索引在使⽤上的区别： 
-  聚集索引的叶⼦节点存储的就是我们的数据记录，⾮聚集索引的叶⼦节点存储的是数据位置。⾮聚集索引不 会影响数据表的物理存储顺序。 
- ⼀个表只能有⼀个聚集索引，因为只能有⼀种排序存储的⽅式，但可以有多个⾮聚集索引，也就是多个索引 ⽬录提供数据检索。 
- 使⽤聚集索引的时候，数据的查询效率⾼，但如果对数据进⾏插⼊，删除，更新等操作，效率会⽐⾮聚集索 引低。
- 采⽤聚集索引进⾏数据查询，⽐使⽤⾮聚集索引的查询效率略⾼。如果查询次数⽐较多，还是尽量使⽤主键 索引进⾏数据查询。
## 按照字段个数进⾏划分
### 单⼀索引
- 索引列为⼀列
### 联合索引
- 多个列组合在⼀起创建的索引
- 需要注意创建时的顺序问题，因为联合索引(x, y, z)和(z, y, x)在使⽤的时候效率可能会存在差别。
- 联合索引存在最左匹配原则，也就是按照最左优先的⽅式进⾏索引的匹配。⽐如(x, y, z),如果查询条件是WHERE x=1 AND y=2 AND z=3，就可以匹配上联合索引;如果查询条件是WHERE y=2，就⽆法匹配上联合索引。 

# 总结:
- 索引的优点:可以直接从大量数据中快速定位想要查找的数据
- 索引的缺点:1.占用存储空间. 2.降低数据库写操作的性能. 3.有多个索引会增加索引的选择的时间.








